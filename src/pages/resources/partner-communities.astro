---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';
import Layout from '~/layouts/PageLayout.astro';

import { SITE } from '~/config/site/config.js';

const metadata = {
  title: `Related Communities - ${SITE.title}`,
  description: 'Organizations and networks in computational biology, bioinformatics, and related fields.',
};

const allCommunities = await getCollection('communities');

// Group by type
const groupedByType = {
  bioinformatics: allCommunities.filter((c) => c.data.category === 'bioinformatics'),
  biotech: allCommunities.filter((c) => c.data.category === 'biotech'),
  'data-science': allCommunities.filter((c) => c.data.category === 'data-science'),
};
---

<Layout metadata={metadata}>
  <!-- Header Section -->
  <section class="text-center pt-16 pb-8">
    <div class="container max-w-5xl mx-auto px-4">
      <h1 class="text-4xl sm:text-5xl font-bold mb-6 leading-tight text-gray-900 dark:text-white">
        Related Communities
      </h1>

      <p class="text-lg sm:text-xl text-muted dark:text-slate-300 mb-8">
        Organizations and networks in computational biology, bioinformatics, and related fields.
      </p>
    </div>
  </section>

  <section class="py-8 px-4 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold mb-8 text-gray-900 dark:text-white">Browse by Category</h2>
    {
      Object.entries(groupedByType).map(([category, communities]) =>
        communities.length > 0 ? (
          <div class="mb-10">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-slate-200">
              {category
                .split('-')
                .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ')}
            </h3>
            <div class="grid gap-4 md:grid-cols-2">
              {communities.map((resource) => (
                <a
                  href={resource.data.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="border border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:shadow-lg hover:border-primary dark:hover:border-blue-400 transition-all bg-white dark:bg-gray-800 block cursor-pointer group"
                >
                  <h4 class="text-lg font-semibold mb-2 text-primary dark:text-blue-400 group-hover:underline">
                    {resource.data.name}
                  </h4>
                  <p class="text-sm text-muted dark:text-slate-300">{resource.data.description}</p>
                  {resource.data.focus && resource.data.focus.length > 0 && (
                    <div class="mt-3 flex flex-wrap gap-2">
                      {resource.data.focus.map((tag) => (
                        <span class="text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                  {(resource.data.female || resource.data.boston) && (
                    <div class="mt-3 flex flex-wrap gap-3 text-sm">
                      {resource.data.female && (
                        <span class="flex items-center gap-1 text-gray-700 dark:text-gray-300">
                          <Icon name="tabler:check" class="w-4 h-4 text-green-600 dark:text-green-400" />
                          Women-focused
                        </span>
                      )}
                      {resource.data.boston && (
                        <span class="flex items-center gap-1 text-gray-700 dark:text-gray-300">
                          <Icon name="tabler:check" class="w-4 h-4 text-green-600 dark:text-green-400" />
                          Boston chapter
                        </span>
                      )}
                    </div>
                  )}
                </a>
              ))}
            </div>
          </div>
        ) : null
      )
    }
    <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Help us grow this list</h2>
    <div class="text-base sm:text-lg text-gray-700 dark:text-slate-300 max-w-3xl">
      <p class="mb-4">
        We're committed to building connections across the bioinformatics and computational biology communities. If your
        organization shares our mission of supporting women and gender minorities in these fields, or if you know of a
        community we've missed, please reach out!
      </p>
      <p class="mb-4">
        <span class="font-semibold">Email us at:</span>
        <a
          href="mailto:Bostonwomeninbioinformatics@gmail.com"
          class="text-primary dark:text-blue-400 hover:underline ml-1"
        >
          Bostonwomeninbioinformatics@gmail.com
        </a>
      </p>
      <p class="mb-2 font-semibold">Please include:</p>
      <ul class="list-disc list-inside mb-4 space-y-1 ml-4">
        <li>Community/organization name</li>
        <li>Website URL</li>
        <li>One sentence describing your mission and activities</li>
        <li>Primary focus areas</li>
      </ul>
      <p class="mb-4">We review submissions regularly and aim to respond within two weeks.</p>
    </div>
  </section>
</Layout>
